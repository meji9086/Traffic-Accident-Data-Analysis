import streamlit as st
import pandas as pd
import seaborn as sns
import plotly.express as px
import matplotlib.pyplot as plt
import koreanize_matplotlib

# ê³µì‹ ë¬¸ì„œë¥¼ ì°¾ì•„ í”„ë¡œì íŠ¸ì— ì ìš©í•´ë³´ê¸°
#head ë¶€ë¶„
st.set_page_config(
    page_title="ì‚¬ê³  ì¢…ë¥˜ ë³„ êµí†µì‚¬ê³ ",
    page_icon="ğŸš—",
    layout="wide",
)

st.markdown("# ì‚¬ê³  ì¢…ë¥˜ë³„ êµí†µì‚¬ê³  ğŸš—")
st.sidebar.markdown("# ì‚¬ê³  ì¢…ë¥˜ë³„ êµí†µì‚¬ê³  ğŸš—")

# @st.cache  # ë°ì´í„°ìš©ëŸ‰ì´ í° ê²½ìš° ë°ì´í„° ë¡œë“œê°€ ì˜¤ë˜ ê±¸ë¦¬ê¸° ë•Œë¬¸ì— í•œë²ˆ ë¡œë“œí–ˆìœ¼ë©´ ìƒˆë¡œ ë¡œë“œí•˜ì§€ ì•Šê³  ê¸°ì¡´ ë°ì´í„°ë¥¼ ì‚¬ìš©í•´ ë¶€ë‹´ì„ ì¤„ì´ê¸° ìœ„í•´, ì†ë„ë¬¸ì œë„ í•´ê²° 
# def load_data():
#     data = pd.read_excel("/Users/youngbinlee/ais7/Mid/accident_type.xlsx",index_col=0)
#     return data

@st.cache(allow_output_mutation=True)
def load_data():
    data =  pd.read_csv(
        "https://raw.githubusercontent.com/meji9086/Traffic-Accident-Data-Analysis/master/data/accident_type.csv"
        , encoding='UTF-8')
    return data
data = load_data()

data.columns = ["","ì›”","ì‚¬ê³ ìœ í˜•","ì‚¬ê³ ë¶„ë¥˜","ì‚¬ê³ ë¶„ë¥˜_ì†Œ","ì‚¬ê³ ë¶„ë¥˜_ëŒ€","ì‚¬ê³ ìˆ˜","ê³„ì ˆ","ë°œìƒì¥ì†Œ","ë³´í–‰ì¤‘êµí†µì‚¬ê³ "]



data_load_state = st.text('Loading data...')
data = load_data()
data_load_state.text("Done! (using st.cache)")

st.markdown("## ê°œìš”")
st.markdown("""
ì‚¬ê³  ìœ í˜•ë³„ ë°ì´í„°ëŠ” ì‚¬ê³  ëŒ€ìƒê³¼ ì‚¬ê³  ìœ í˜•, í”¼í•´ì¢…ë¥˜ì— ëŒ€í•´ ë‚˜íƒ€ë‚¸ ë°ì´í„°ì´ë‹¤. \n
ì°¨ì™€ ì°¨, ì°¨ì™€ ì‚¬ëŒ ê·¸ë¦¬ê³  ì°¨ëŸ‰ ë‹¨ë…ìœ¼ë¡œ ì¼ì–´ë‚  ìˆ˜ ìˆëŠ” ì‚¬ê³  ìœ í˜•ì„ ë¶„ë¥˜í•´ ì›”ë³„ ì‚¬ë§/ì‚¬ìƒ/ë¶€ìƒ ë°œìƒ ê±´ìˆ˜ë¥¼ í¬í•¨í•˜ê³ ìˆë‹¤.

""")

# ë³´ë„= data[(data["ë°œìƒì¥ì†Œ"] =="ë³´ë„")|(data["ë°œìƒì¥ì†Œ"] =="ì°¨ë„")]

st.markdown("### ê°€ì„¤ 1. ì°¨vsì‚¬ëŒê°„ì˜ êµí†µì‚¬ê³ ëŠ” íš¡ë‹¨ë³´ë„ì—ì„œ ê°€ì¥ ë§ì´ ë°œìƒí–ˆì„ ê²ƒì´ë‹¤.")
gh1 = px.histogram(data[data["ë³´í–‰ì¤‘êµí†µì‚¬ê³ "]], x='ì‚¬ê³ ë¶„ë¥˜_ì†Œ',y='ì‚¬ê³ ìˆ˜',title = 'ë³´í–‰ ì¤‘ êµí†µì‚¬ê³ ')
st.plotly_chart(gh1)
st.markdown("""
ë³´ë„ í†µí–‰ ì¤‘ë³´ë‹¤ ê¸¸ ê°€ì¥ìë¦¬ êµ¬ì—­ í†µí–‰ ì¤‘ ì‚¬ê³ ê°€ ë°œìƒí•˜ëŠ” ë¹„ìœ¨ì´ ì›”ë“±íˆ ë†’ì•˜ë‹¤. \n
ê¸¸ ê°€ì¥ìë¦¬ëŠ” ë³´í–‰ ì¤‘ êµí†µì‚¬ê³  ì›ì¸ì€ 1
í•´ì„¤í•´ì„¤í•´ì„¤
""")
st.markdown("### ê°€ì„¤ 2: ê³„ì ˆë³„ë¡œ ë§ì´ ë°œìƒí•˜ëŠ” íŠ¹ì • ì‚¬ê³ ê°€ ìˆì„ ê²ƒì´ë‹¤")
gh2= px.bar(data, x="ì‚¬ê³ ë¶„ë¥˜_ì†Œ",y="ì‚¬ê³ ìˆ˜", color ="ì‚¬ê³ ë¶„ë¥˜_ì†Œ",facet_col ='ê³„ì ˆ', title= 'ê³„ì ˆë³„ ì‚¬ê³  íŠ¹ì§•')
st.plotly_chart(gh2)
st.markdown("""
ê·¸ë ‡ì§€ë„ ì•Šë‹¤. ë‹¤ë§Œ ë´„,ê°€ì„ì€ í–‰ë½ê°ì˜ ì¦ê°€ë¡œ ì¸í•œ ë„ë¡œìœ„ êµí†µì‚¬ê³ ê°€ ëŠ˜ì–´ë‚œ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.    \n
í•´ì„¤í•´ì„¤í•´ì„¤ \n
""")


st.markdown("### ê°€ì„¤ 3: \n")

st.markdown("## ì œì•ˆ: ê¸¸ ê°€ì¥ìë¦¬ì— ì¡°ëª… ì„¤ì¹˜ë¡œ ë³´í–‰ì ì‚¬ê³ ì˜ˆë°© ")
st.markdown("""
-> ** ê¸¸ ê°€ì¥ìë¦¬êµ¬ì—­ì— ë°¤ì´ ë˜ë©´ ì¼œì§€ëŠ” led ì¡°ëª… ì„¤ì¹˜í•˜ì—¬ ë³´í–‰ì í†µí–‰ë¡œì˜ ì‹ë³„ì„±ì„ ë†’ì´ê³  ìš´ì „ìì˜ ì‹œì•¼ í™•ë³´ ** \n
êµ­ë‚´ êµí†µì‚¬ê³  ì‚¬ë§ì 3ëª… ì¤‘ 1ëª…ì€ ë³´í–‰ìì¸ ê²ƒìœ¼ë¡œ ë‚˜íƒ€ë‚¬ë‹¤. \n
ê²½ì°°ì²­ê³¼ ë„ë¡œêµí†µê³µë‹¨ì´ ìµœê·¼ 5ë…„ê°„(2017ë…„~2021ë…„) êµ­ë‚´ êµí†µì‚¬ê³  ì‚¬ë§ìë¥¼ ë¶„ì„í•œ ê²°ê³¼ ì „ì²´ êµí†µì‚¬ê³  ì‚¬ë§ì ì¤‘ 38%ê°€ ë³´í–‰ìì¸ ê²ƒìœ¼ë¡œ ë‚˜íƒ€ë‚¬ë‹¤. ì´ëŠ” OECD íšŒì›êµ­ í‰ê· ì¸ 19.3%(2019ë…„ë„ OECD í†µê³„ ê¸°ì¤€)ë³´ë‹¤ 2ë°° ë†’ì€ ìˆ˜ì¤€ì´ë‹¤.\n
ì´ ê°™ì€ ë¬¸ì œë¥¼ ê°œì„ í•˜ê¸° ìœ„í•´ ì§€ë‚œ 4ì›” 20ì¼ ë³´ì°¨í˜¼ìš©ë„ë¡œ ë³´í–‰ì í†µí–‰ ìš°ì„ ê¶Œ ë³´ì¥ì„ ê³¨ìë¡œ í•œ ê°œì • ë„ë¡œêµí†µë²•ì´ ì‹œí–‰ë˜ì—ˆì§€ë§Œ ì—¬ì „íˆ ë³´í–‰ìì˜ êµí†µì‚¬ê³ ìœ¨ì€ ë†’ì€ ìˆ˜ì¤€ì´ë‹¤. \n 
ê·¸ ì¤‘ ê¸¸ ê°€ì¥ìë¦¬ êµí†µì‚¬ê³ ìœ¨ì´ ë‘ë“œëŸ¬ì§€ëŠ”ë°, ë³´ë„ì™€ ì°¨ë„ê°€ ë¶„ë¦¬ë˜ì§€ ì•Šê³  ì¤‘ì•™ì„ ì´ ìˆëŠ” ë„ë¡œì˜ ê²½ìš° ê¸¸ ê°€ì¥ìë¦¬ë¡œ í†µí–‰ì„ ì•ˆë‚´í•˜ê³  ìˆë‹¤. í•˜ì§€ë§Œ ì´ëŠ” ì €ë…ì‹œê°„ ë„ë¡œê°€ ì–´ë‘ì›Œ ìš´ì „ìì˜ ì‹œì•¼ì— ë³´í–‰ìê°€ í™•ë³´ê°€ ì–´ë µê¸° ë•Œë¬¸ì— ì‚¬ê³ ê°€ ë°œìƒí•  í™•ë¥ ì´ ë†’ë‹¤ëŠ” í•œê³„ê°€ ìˆë‹¤.\n 
ë³´í–‰ì í†µí–‰ë¡œì˜ ì‹ë³„ì„±ì„ ë†’ì—¬ ìš´ì „ìì˜ ì‹œì•¼ë¥¼ í™•ë³´í•˜ê¸°ìœ„í•´ ê¸¸ ê°€ì¥ìë¦¬êµ¬ì—­ì— ë°¤ì´ ë˜ë©´ ì¼œì§€ëŠ” led ì¡°ëª… ì„¤ì¹˜ë¥¼ ì œì•ˆí•œë‹¤. 

""")

# Sidebar - origin
# sorted_unique_origin = sorted(data.origin.unique())
# selected_origin = st.sidebar.multiselect('origin', sorted_unique_origin, sorted_unique_origin)

# if len(selected_origin) > 0:
#    data = data[data.origin.isin(selected_origin)]


# st.dataframe(data)

# st.line_chart(data["mpg"])

# st.bar_chart(data["mpg"])


# fig, ax = plt.subplots(figsize=(10, 3))
# sns.countplot(data=data, x="origin").set_title("ì§€ì—­ë³„ ìë™ì°¨ ì—°ë¹„ ë°ì´í„° ìˆ˜")
# st.pyplot(fig)

# pxh = px.histogram(data, x="origin", title="ì§€ì—­ë³„ ìë™ì°¨ ì—°ë¹„ ë°ì´í„° ìˆ˜")
# st.plotly_chart(pxh)

